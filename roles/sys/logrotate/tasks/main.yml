---

# Copyright Â© EnterpriseDB Corporation

- name: Add logrotate configuration for Postgres logfile
  template:
    src: postgres.j2
    dest: /etc/logrotate.d/postgres
    owner: root
    group: root
    mode: 0644
  vars:
    postgres_logfile: "{{
      (log_destination == 'syslog')|ternary(
        '/var/log/postgres/postgres.log', '/var/log/postgresql/postgres.log'
      )
    }}"

- name: Set up a cron job to run logrotate every 10 minutes
  cron:
    user: root
    cron_file: /etc/cron.d/tpa_logrotate
    name: Run logrotate every 10 minutes
    minute: "*/10"
    hour: "*"
    day: "*"
    month: "*"
    weekday: "*"
    job: >
      /usr/sbin/logrotate /etc/logrotate.conf
    state: present
