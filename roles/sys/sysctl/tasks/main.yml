---

# Copyright Â© 2ndQuadrant Limited <info@2ndquadrant.com>

# Set any sysctl values specified by the caller, which may augment or
# override the default values defined in by this role.

- name: Set sysctl values
  sysctl:
    name: "{{ item.key }}"
    value: "{{ item.value }}"
    state: present
    sysctl_file: /etc/sysctl.conf
    reload: yes
  with_dict: "{{
    sysctl_defaults
    |combine(_ip_forward)
    |combine(sysctl_values)
  }}"
  when: >
    platform not in ['docker', 'lxd']
  vars:
    _ip_forward: "{{
      ('openvpn-server' in role)|ternary({'net.ipv4.ip_forward': 1}, {})
    }}"

- include_tasks: hugepages.yml
  when: >
    platform not in ['docker', 'lxd']
