---

# Â© Copyright EnterpriseDB UK Limited 2015-2021 - All rights reserved.

- name: Install Python
  raw: if ! command -v {{ python }} >/dev/null 2>&1; then yum -y install {{ python.startswith('python2')|ternary('python', 'python3') }}; fi
  environment: {}
  register: python_install
  changed_when: >
    python_install is successful
    and python_install.stdout.strip() != ''
    and 'already installed' not in python_install.stdout

- name: Install backports.ssl_match_hostname
  raw: >
    if [ $({{ python }} -c 'import sys; print("old" if sys.version_info < (2,7,9) else "ok")') != "ok" ];
    then {{ python }} -c 'import backports.ssl_match_hostname' >/dev/null 2>&1 || yum -y install python-backports-ssl_match_hostname; true;
    fi
  args:
    executable: /bin/sh
  environment: {}
  register: backport_install
  when: python in ['python2', 'python2.7']
  changed_when: >
    backport_install is successful
    and backport_install.stdout.strip() != ''
    and 'already installed' not in backport_install.stdout
