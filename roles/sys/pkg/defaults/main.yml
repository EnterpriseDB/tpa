---

# Â© Copyright EnterpriseDB UK Limited 2015-2021 - All rights reserved.

## Repositories
#
# By default, we install the PGDG repository (all community packages).
#
# All of the above applies to both apt and yum.

edb_repo_hostname_suffix: "{{ edb_testing_repo|default(false)|bool|ternary('-staging', '') }}.enterprisedb.com"
edb_repo_name_suffix: "{{ edb_testing_repo|default(false)|bool|ternary('-testing', '') }}"

apt_repositories: {}
default_apt_repositories:
  PGDG:
    key_id: ACCC4CF8
    key_url: https://www.postgresql.org/media/keys/ACCC4CF8.asc
    repo: >-
      deb https://apt.postgresql.org/pub/repos/apt/ {{ ansible_distribution_release }}-pgdg main

  EDB:
    key_id: 4EC55148FE026ECC
    key_url: https://apt.enterprisedb.com/edb-deb.gpg.key
    filename: >-
      edb-{{ ansible_distribution_release }}
    repo: >-
      deb [arch=amd64] https://apt{{ edb_repo_hostname_suffix }}/{{ ansible_distribution_release }}-edb{{ edb_repo_name_suffix }}/ {{ ansible_distribution_release }} main

default_apt_repository_list: [PGDG]

yum_repositories: {}
default_yum_repositories:
  EPEL:
    rpm_url: >-
      {{
        (ansible_distribution_id == 'centos')|ternary(
          'epel-release',
          'https://dl.fedoraproject.org/pub/epel/epel-release-latest-%s.noarch.rpm' % ansible_distribution_major_version
        )
      }}

  PGDG:
    rpm_url: >-
      https://download.postgresql.org/pub/repos/yum/reporpms/EL-{{ ansible_distribution_major_version }}-x86_64/pgdg-redhat-repo-latest.noarch.rpm

  EDB:
    rpm_url: >-
      https://yum{{ edb_repo_hostname_suffix }}/edbrepos/edb-repo-latest.noarch.rpm

default_yum_repository_list: [EPEL, PGDG]

## Packages
#
# We define three hashes of package lists here.
#
# 1. Required packages, installed all together.
# 2. Optional packages, installed one by one (failures are ignored).
# 3. Unwanted packages, which should not be installed at all.
#
# Within each hash is a 'common' list (packages that have the same name
# in all supported distributions) and one list against the name of each
# distribution (for packages specific to that distribution).
#
# There are two versions of each hash, e.g., default_packages and
# packages. We define the defaults, and the caller may define any
# additional packages in the same format.
#
# For convenience, all these lists are flattened before use.

packages: {}
default_packages:
  common:
    # Required to support ``become: unprivileged_user``
    - acl
    - tcpdump
    - vim
    - rsync
    - sysstat
    - time
    - strace
    - gdb
    - iotop
    # screen is no longer available on RHEL 8
    - "{{ (ansible_os_family == 'RedHat' and ansible_distribution_major_version|int >= 8)|ternary('tmux', 'screen') }}"
    - dstat
    - openssh-server
    - openssl
    - rsyslog
    - "{{ ['socat'] if 'haproxy' in role else [] }}"
    - "{{ ['cryptsetup'] if (volumes|json_query(\"[?encryption && encryption == 'luks']\") is not empty) else [] }}"
    - lsof
  Debian:
    - "{{ (ansible_distribution_release == 'jessie')|ternary('linux-tools', 'linux-perf') }}"
    # Required for hostnamectl, used in sys
    - "{{ ['dbus'] if platform not in ['docker', 'lxd', 'vagrant'] else [] }}"
    - openssh-client
  RedHat:
    - perf
    # Required for semanage, used in postgres/initdb
    - "policycoreutils-python{% if ansible_distribution_major_version == '8' %}-utils{% endif %}"
    - openssh
    - openssh-clients
    - cronie
  Ubuntu:
    - linux-tools-generic
    - openssh-client

optional_packages: {}
default_optional_packages:
  common:
    # The following packages are available only through the EPEL
    # repository on RHEL.
    - htop
    - pigz
  Debian: []
  RedHat: []
  Ubuntu: []

unwanted_packages: {}
default_unwanted_packages:
  Debian: &debian_unpackages [ unattended-upgrades ]
  RedHat: []
  Ubuntu: *debian_unpackages
