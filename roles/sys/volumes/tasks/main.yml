---

# Each instance has a list of attached volumes, including the device
# name and any vars specified for it. We invoke sys/fs on each one.

- name: Define volume_for translations
  set_fact:
    _translations:
      postgres_data:
        mountpoint: /opt/postgres
      barman_data:
        mountpoint: /var/lib/barman

- include_role: name=sys/fs
  vars:
    _volume_for: >-
      {{ item.get('volume_for', None) }}
    _settings: >
      {{
        _translations[_volume_for]|default({
          'mountpoint': item.mountpoint
        })
      }}
    device: "{{ item.device }}"
    mountpoint: "{{ _settings['mountpoint'] }}"
  with_items:
    "{{ volumes|default([]) }}"
