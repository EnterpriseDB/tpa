---

# Â© Copyright EnterpriseDB UK Limited 2015-2022 - All rights reserved.

- block:
  - name: Ensure harp-manager service directory exists
    file:
      path: "/etc/systemd/system/harp-manager.service.d"
      state: directory
      owner: root
      group: root
      mode: 0755

  - name: Install harp-manager service override file
    template:
      src: harp.service.j2
      dest: "/etc/systemd/system/harp-manager.service.d/override.conf"
      owner: root
      group: root
      mode: 0644
    register: manager_unit
  when: >
    'postgres' in role

- block:
  - name: Ensure harp-proxy service directory exists
    file:
      path: "/etc/systemd/system/harp-proxy.service.d"
      state: directory
      owner: root
      group: root
      mode: 0755

  - name: Install harp-proxy service override file
    template:
      src: harp.service.j2
      dest: "/etc/systemd/system/harp-proxy.service.d/override.conf"
      owner: root
      group: root
      mode: 0644
    register: proxy_unit
  when: >
    'harp-proxy' in role
