---

# Copyright Â© 2ndQuadrant Limited <info@2ndquadrant.com>

# Install nsca-ng packages and configuration files

- name: Install nsca-ng server package
  apt: pkg=nsca-ng-server state=latest

#- name: Ensure nsca-ng-server daemon starts on boot
#  copy: src={{inventory_hostname}}/nsca-ng/nsca-ng-server dest=/etc/default/nsca-ng-server

- name: Remove /etc/nsca-ng/nsca-ng.local.cfg if exists
  file: path=/etc/nsca-ng/nsca-ng.local.cfg state=absent

- name: Install nsca-ng main configuration file
  copy: src=nsca-ng/nsca-ng.cfg dest={{nsca_configfile}}
  notify: Restart nsca-ng

# nsca configuration
- name: Add client nsca-ng configuration file
  template: src=nsca-client-template.cfg.j2 dest="{{nsca_configdir}}/customer-{{item}}.cfg" owner=root
  notify: Restart nsca-ng
  tags: nsca-ng
  with_items: "{{client_identifier}}"

- name: Add include directive for client configuration file
  lineinfile: path="{{nsca_configdir}}/{{nsca_includefile}}" line="include({{nsca_configdir}}/customer-{{item}}.cfg)" create=yes
  notify: Restart nsca-ng
  tags: nsca-ng
  with_items: "{{client_identifier}}"
