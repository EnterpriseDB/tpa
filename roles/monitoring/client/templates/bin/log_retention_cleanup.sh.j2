{# Copyright Â© 2ndQuadrant Limited <info@2ndquadrant.com> #}
#!/bin/bash
#
# {{ansible_managed}}

# We need to read $PGDATA from .bash_profile. Maybe we should retrive this
# information from some other place, or in some other
if [ -f .bash_profile ]
then
    . .bash_profile
else
    # There's no .bash_profile, so this most likely won't work
    exit 1
fi

# The log directory
PGLOG=$PGDATA/pg_log/

# The retention policy in days
RETENTION={{log_retention}}
COMPRESSION={{log_compression_delay}}

# Look for files in PGLOG older the RETENTION and remove them.
find $PGLOG -name "postgresql-*" -mtime +$RETENTION -exec rm -f {} + 

# Look for log files in PGLOG older than COMPRESSION and compress them.
find $PGLOG -name "postgresql-*.{{log_type_ext}}" -mtime +$COMPRESSION -exec gzip -9 {} +
