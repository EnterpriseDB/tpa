---

# Copyright Â© 2ndQuadrant Limited <info@2ndquadrant.com>

- name: Install postgres-monitor
  template:
    src: postgres-monitor.j2
    dest: /etc/tpa/postgres-monitor
    owner: root
    group: root
    mode: 0755
  tags: [postgres, service]

- name: Install Postgres service unit files
  template:
    src: "{{ item.0 }}.service.j2"
    dest: "/etc/systemd/system/{{ item.1 }}.service"
    owner: root
    group: root
    mode: 0644
  with_together:
    - [postgres, postgres-monitor]
    - ['{{ postgres_service_name }}',
       '{{ postgres_service_name }}-monitor']
  tags: [postgres, service]

- name: Enable postgres services
  systemd:
    name: "{{ item }}"
    enabled: "{{ not postgres_volume_encrypted|bool }}"
  with_items:
    - "{{ postgres_service_name }}"
    - "{{ postgres_service_name }}-monitor"
  tags: [postgres, service]
