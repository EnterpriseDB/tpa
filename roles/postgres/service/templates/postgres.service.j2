{# Copyright Â© 2ndQuadrant Limited <info@2ndquadrant.com> #}
[Unit]
Description=Postgres {{ postgres_version }} (TPA)
After=syslog.target
After=network.target

[Service]
Type=simple
User={{ postgres_user }}
Group={{ postgres_group }}
OOMScoreAdjust=-1000
Environment=PGDATA={{ postgres_data_dir }}
{% if postgres_service_environment is defined and postgres_service_environment is mapping %}
{%   for k in postgres_service_environment.keys() %}
Environment={{ k }}={{ postgres_service_environment[k] }}
{%   endfor %}
{% endif %}
StandardOutput=syslog
ExecStart={{ postgres_bin_dir }}/postmaster -D ${PGDATA}
{% if postgres_coredump_filter is defined %}
ExecStartPost=/bin/bash -c 'echo {{ postgres_coredump_filter }} > /proc/$MAINPID/coredump_filter'
PermissionsStartOnly=true
{% endif %}
ExecReload=/bin/kill -HUP $MAINPID
KillMode=mixed
KillSignal=SIGINT
Restart={{ systemd_restart_postgres_service|default('no') }}
LimitCORE=infinity

[Install]
WantedBy=multi-user.target
