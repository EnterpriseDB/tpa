---

# Copyright Â© EnterpriseDB Corporation

- name: Join group {{ bdr_node_child_group }} on {{ bdr_node }} via {{ bdr_upstream|default(first_bdr_primary) }}
  postgresql_query:
    conninfo: "{{ hostvars[bdr_node].bdr_node_dsn }}"
    queries:
      - text: SELECT bdr.join_node_group(join_target_dsn := %s, node_group_name := %s, pause_in_standby := %s)
        args:
          - "{{ bdr_upstream_dsn|default(bdr_node_dsn) }}"
          - "{{ bdr_node_child_group }}"
          - "{{ hostvars[bdr_node].bdr_node_pause_in_standby }}"
  become_user: "{{ postgres_user }}"
  become: yes
  vars:
    bdr_node_child_group: "{{
      hostvars[bdr_node].bdr_child_group|default(
      hostvars[bdr_node].bdr_node_group)
    }}"
  changed_when: True
