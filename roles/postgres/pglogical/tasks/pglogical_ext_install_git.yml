---
- name: clone or update pglogical_output extension git
  git: repo="{{pglogical_ext_git_url}}" dest="{{pglogical_ext_git_checkout_dir}}"
       version="{{pglogical_ext_git_ref}}"
       reference="{{pglogical_ext_git_reference_repo}}"
  when: pglogical_ext_git_install

- name: make build directory
  file: state=directory path="{{pglogical_ext_git_builddir}}"
  when: pglogical_ext_git_install

- name: configure pglogical_output extension - make all
  shell: "{{pglogical_ext_git_make_command}} USE_PGXS=1 clean && {{pglogical_ext_git_make_command}} USE_PGXS=1 all && {{pglogical_ext_git_make_command}} USE_PGXS=1 install"
  args:
    chdir: "{{pglogical_ext_git_builddir}}"
  environment:
    PATH: "{{item.install_dir}}/bin:{{ansible_env.PATH}}"
  when: pglogical_ext_git_install
  with_items:
    - { install_dir: "{{postgres_git_install_dir}}" }
    - { install_dir: "{{postgres_9_5_git_install_dir}}" }
    - { install_dir: "{{postgres_9_4_git_install_dir}}" }

