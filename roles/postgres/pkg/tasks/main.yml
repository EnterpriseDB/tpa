---

# Copyright Â© 2ndQuadrant Limited <info@2ndquadrant.com>

# Given a Postgres version, we perform distribution-specific tasks to
# enable repositories and install Postgres packages.

- include_tasks: list-packages.yml
  tags: always

- name: Install Postgres packages
  package:
    name: "{{ all_postgres_packages }}"
    state: present

- include_tasks:
    file: debuginfo.yml
    apply:
      tags: [postgres, pkg, debuginfo]
  tags: always

- include_tasks:
    file: psycopg2.yml
    apply:
      tags: [postgres, pkg, psycopg2]
  tags: always

# We install our own service units later, so we disable the packaged
# versions here.

- name: Disable default postgresql services
  systemd:
    name: "{{ default_postgres_service_names[ansible_os_family] }}"
    state: stopped
    masked: yes
  tags: service
