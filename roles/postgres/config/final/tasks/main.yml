---

# Copyright Â© 2ndQuadrant Limited <info@2ndquadrant.com>

# We've already installed configuration files for any extensions that we
# care about; now it's time to issue CREATE EXTENSION commands.

- name: Install default Postgres extensions
  postgresql_ext:
    state: present
    db: "{{ item.0 }}"
    name: "{{ item.1 }}"
  with_nested:
    - [postgres, template1]
    - "{{ postgres_extensions|default([]) }}"
  become_user: "{{ postgres_user }}"
  become: true

- include_tasks:
    file: pgbouncer.yml
    apply:
      tags: pgbouncer
  when: >
    postgres_users|json_query("[?username=='pgbouncer']") != []
  tags: always
