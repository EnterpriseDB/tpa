# Automatically generated by postgres/config from pg_hba.conf.j2.
#
# Any changes made to this file may be overwritten.

# TYPE  DATABASE        USER            ADDRESS                 METHOD
local   all             postgres                                peer
local   all             all                                     trust
host    all             all             127.0.0.1/32            trust
host    all             all             ::1/128                 trust
{% for n in cluster_networks|default([]) %}
host    postgres        barman          {{ n }}   md5
host    repmgr          repmgr          {{ n }}   md5
host    replication     all             {{ n }}   md5
host    all             all             {{ n }}   md5
{% else %}
{%   for h in groups[cluster_tag] %}
{%     set role=hostvars[h].get('role', []) %}
{%     set addr=hostvars[h].ip_address %}
{%     set type='hostssl' %}
{%     if addr == hostvars[h].get('openvpn_ip', '') %}
{%       set type='host' %}
{%     endif %}
{%     set addr=addr+'/32' %}
# {{ h }}
{%     if 'barman' in role %}
{{type}} postgres barman {{ addr }} md5
{{type}} replication streaming_barman {{ addr }} md5
{%     endif %}
{%     if 'postgres' in role %}
{{type}} repmgr repmgr {{ addr }} md5
{{type}} replication repmgr {{ addr }} md5
{{type}} replication postgres {{ addr }} md5
{{type}} all all {{ addr }} md5
{%     endif %}
{%   endfor %}
{% endfor %}

{% for l in postgres_hba_settings %}
{{l}}
{% endfor %}
hostssl all all 0.0.0.0/0 md5
