# Please do not edit this file. Your changes will be overwritten. Put
# your configuration overrides into conf.d/9999-override.conf instead.

listen_addresses = '*'
port = {{ postgres_port }}
unix_socket_directories = '/var/run/postgresql, /tmp'

max_connections = {{ max_connections|default(250) }}

shared_buffers = {{ shared_buffers|default(shared_buffers_mb~'MB') }}
max_prepared_transactions = {{ max_prepared_transactions|default(0) }}

max_worker_processes = {{ max_worker_processes|default(16) }}

logging_collector = {{ logging_collector|default('off') }}

{% if postgres_version|version_compare('9.4', '>') %}
cluster_name = '{{ inventory_hostname }}'
{% endif %}

archive_mode = on

max_wal_senders = {{ max_wal_senders|default(16) }}
max_replication_slots = {{ max_replication_slots|default(16) }}
wal_keep_segments = {{ wal_keep_segments|default(0) }}
{% if postgres_version|version_compare('9.4', '>') %}
track_commit_timestamp = {{ track_commit_timestamp|default('off') }}
{% endif %}

hot_standby = on

ssl = on
ssl_ca_file = '{{ ssl_ca_file|default("") }}'
ssl_crl_file = '{{ ssl_crl_file|default("") }}'
ssl_cert_file = '{{ ssl_cert_file|default("/etc/tpa/"+cluster_name+".crt") }}'
ssl_key_file = '{{ ssl_key_file|default("/etc/tpa/"+cluster_name+".key") }}'
ssl_ciphers = 'HIGH:!3DES:!aNULL'
ssl_prefer_server_ciphers = on

autovacuum_max_workers = {{ autovacuum_max_workers|default(3) }}
autovacuum_freeze_max_age = {{ autovacuum_freeze_max_age|default(200000000) }}
autovacuum_multixact_freeze_max_age = {{ autovacuum_multixact_freeze_max_age|default(400000000) }}

wal_level = {{ wal_level|default('logical') }}

wal_log_hints = {{ wal_log_hints|default('on') }}
wal_buffers = {{ wal_buffers|default(-1) }}

shared_preload_libraries = '{{ shared_preload_libraries|default("") }}'
