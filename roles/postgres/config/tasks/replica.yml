---

# Since we need to include this both from ./main.yml and
# roles/repmgr/replica/final/tasks/clone.yml, we must jump through some
# hoops to ensure that the paths resolve correctly in both cases.

- set_fact: dot="{{ tpa_dir }}/roles/postgres/config"

- include_tasks: "{{ dot }}/tasks/include-conf.yml"

- name: Install replica configuration override file
  template:
    src: "{{ dot }}/templates/replica.conf.j2"
    dest: "{{ _include_dir }}/8900-replica.conf"
    owner: "{{ postgres_user }}"
    group: "{{ postgres_group }}"
    mode: 0644
  notify:
    - Note Postgres reload required

- name: Install replica restart-only configuration override file
  template:
    src: "{{ dot }}/templates/replica_restart.conf.j2"
    dest: "{{ _include_dir }}/8901-replica_restart.conf"
    owner: "{{ postgres_user }}"
    group: "{{ postgres_group }}"
    mode: 0644
  notify:
    - Note Postgres restart required

- include_tasks: "{{ dot }}/tasks/override.yml"
