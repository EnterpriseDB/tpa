---

- name: Ensure that ec2.py succeeded
  assert:
    msg: "No ec2_id defined for AWS EC2 instance (did ec2.py fail?)"
    that: ec2_id is defined

- name: Translate platform-specific variables names
  action: set_fact
  args:
    "{{ item.var }}": "{{ vars[item.source] }}"
  when:
    item.source in vars and
    (item.var not in vars or ('override' in item and item.override))
  with_items:
    - var: name
      source: ec2_tag_Name

# An EC2 instance in a VPC will always have a private IP address. It may
# also have a public IP address (which may or may not be an elastic IP).
# The static inventory file that we generate will have ansible_host set
# to an elastic IP, or if one does not exist, the public IP, or if that
# doesn't exist either, the private IP.

- name: Set private IP address
  set_fact:
    private_ip: "{{ ec2_private_ip_address|default(ansible_host) }}"
  when:
    private_ip is not defined

- name: Set public IP address if available
  set_fact:
    public_ip: "{{ ec2_ip_address }}"
  when:
    public_ip is not defined and
    ec2_ip_address is defined
