---

# Add 'postgres' to role when any of 'primary' or 'replica' or 'witness'
# is given, just as a convenience.

- name: Add implicit postgres role if needed
  set_fact:
    role: "{{ role|union(['postgres']) }}"
  when: >
    'primary' in role or 'replica' in role or 'witness' in role

# Add 'postgres-xl' to role when any of 'coordinator' or 'datanode'
# or 'coordinator-replica' or 'datanode-replica' or 'gtm' or
# 'gtm-standby' is given

- set_fact:
    role: "{{ role|union(['postgres-xl']) }}"
  when: >
    'coordinator' in role or 'datanode' in role or 'coordinator-replica' in role or 'datanode-replica' in role or 'gtm' in role or 'gtm-standby' in role

# If there's anything tagged as an openvpn server, we have to make sure
# vpn_network is defined.

- assert:
    msg: "Please define vpn_network to use sys/openvpn"
    that:
      - vpn_network is defined
  when: >
    'openvpn-server' in role
