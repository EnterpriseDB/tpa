---
# Â© Copyright EnterpriseDB UK Limited 2015-2022 - All rights reserved.

- name: Set tpa_dir
  set_fact:
    tpa_dir: "{{ tpa_dir|default(lookup('env', 'TPA_DIR')) }}"

- name: Set cluster_dir to Tower project directory, if available
  vars:
    awx_data_dir: "{{ lookup('env', 'AWX_PRIVATE_DATA_DIR') }}"
  when:
    cluster_dir is not defined and awx_data_dir != ''
  block:
  - stat:
      path: "{{ awx_data_dir ~ '/project' }}"
    register: project_dir
    delegate_to: localhost
  - assert:
      that: project_dir.stat.exists
      fail_msg: project directory not found in {{ awx_data_dir }}
  - set_fact:
      cluster_dir: "{{ project_dir.stat.path }}"

- include_tasks: ssh.yml
  when: ansible_connection == 'ssh'

- include_role:
    name: "platforms/{{ platform }}"

- include_role: name=platforms/common
