---

# If pwgen is not installed, we would silently generate invalid YAML
# in roles/secret, so we check up-front and fail early. We depend on
# flock to workaround a problem with run_once, so check for that too.

- name: Ensure that local dependencies are installed
  become: no
  assert:
    msg: "Please install {{ item }} locally"
    that:
      - "'{{ lookup('pipe', 'command -v {{ item }} || true') }}' != ''"
  with_items:
    - pwgen
    - flock
  run_once: yes

- include: ssh.yml
