---

# We want to call this repmgrd.service, but there's a systemd bug (at
# least on Debian 8) that prevents us from overriding the unit that is
# created by the late generator from /etc/init.d/repmgrd. Using a name
# that doesn't conflict is the easiest workaround.

- name: Install custom repmgr service unit file
  template:
    src: repmgrd.service.j2
    dest: /etc/systemd/system/repmgr.service
    owner: root
    group: root
    mode: 0644
  tags: [repmgr, service]

- name: Enable repmgr service
  systemd:
    name: repmgr
    enabled: "{{ not postgres_volume_encrypted|bool }}"
  tags: [repmgr, service]
