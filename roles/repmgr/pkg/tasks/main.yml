---

# Â© Copyright EnterpriseDB UK Limited 2015-2021 - All rights reserved.

- name: Install repmgr package
  package:
    name: "{{
      repmgr_packages|packages_for(ansible_os_family, repmgr_package_version)
    }}"
    state: "{{
      (repmgr_package_version is defined)|ternary('present', 'latest')
    }}"

# We install our own service units later, so we disable the packaged
# versions here. The default service name on Debian is repmgrd, but it
# has only an init file, not a unit file. However, we used to install a
# repmgr96.service file to match what was installed by default on RHEL.
# So we try to disable all of them and ignore failures.

- name: Disable default repmgr services
  systemd:
    name: "{{ item }}"
    state: stopped
    masked: yes
  ignore_errors: yes
  with_items:
    - repmgrd
    - repmgr{{ postgres_versionNN }}
