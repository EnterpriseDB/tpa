---

# Copyright Â© 2ndQuadrant Limited <info@2ndquadrant.com>

- name: Check if PGDATA has been initialised
  stat:
    path: "{{ postgres_data_dir }}/PG_VERSION"
  register: pgdata
  become_user: "{{ postgres_user }}"
  become: yes
  when: >
    'postgres' in role
  tags: always

- name: Check if repmgr has been initialised
  stat:
    path: "{{ repmgr_conf_file }}"
  register: repmgr
  become_user: "{{ postgres_user }}"
  become: yes
  when: >
    'postgres' in role
  tags: always

- name: Set tested facts
  set_fact:
    pgdata_initialised: "{{ pgdata is not skipped and pgdata.stat.exists }}"
    repmgr_initialised: "{{ repmgr is not skipped and repmgr.stat.exists }}"
  tags: always
