---

- assert:
    msg: "output_dir must be defined"
    that: output_dir is defined

- name: Ensure that each instance has an output subdirectory
  local_action:
    module: file
    path: "{{ output_dir }}/{{ inventory_hostname }}"
    state: directory

- include_tasks: postgres.yml
  when: >
    'postgres' in role
  tags: postgres

- include_tasks: barman.yml
  when: >
    'barman' in role
  tags: barman

- include_role: name=pgbench
  when: >
    'postgres' in role
  tags: pgbench
