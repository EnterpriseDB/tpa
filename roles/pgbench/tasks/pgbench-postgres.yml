---

# Copyright Â© 2ndQuadrant Limited <info@2ndquadrant.com>

- include_role: name=pgbench/init
  vars:
    pgbench_output: pgbench-postgres-init.txt
  when: >
    'replica' not in role

- name: Run parallel read/write workload on primaries
  include_tasks: pgbench.yml
  vars:
    pgbench_opts: -v -c 10 -j 5 -T 180 {{ pgbench_dbname }}
    pgbench_output: pgbench-postgres-rw.txt
  when: >
    'replica' not in role

- name: Run parallel read-only workload on replicas
  include_tasks: pgbench.yml
  vars:
    pgbench_opts: -n -c 10 -j 5 -T 180 -S {{ pgbench_dbname }}
    pgbench_output: pgbench-postgres-ro.txt
  when: >
    'replica' in role
