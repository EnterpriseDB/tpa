---

# Copyright Â© 2ndQuadrant Limited <info@2ndquadrant.com>

- include_role:
    name: common/pkg
    apply:
      tags: [common, pkg]
  tags: always

- name: Set the hostname
  hostname: name="{{ inventory_hostname }}"
  when:
    platform not in ['docker']
  tags: [common, hostname]

- name: Ensure authorized_keys allows admin access
  authorized_key:
    user: "{{ ansible_user|default('root') }}"
    key: "{{ lookup('file', '%s/%s.pub' % (cluster_dir, ssh_key_file)) }}"
  when: ssh_key_file is defined

- include_tasks:
    file: tpa.yml
    apply:
      tags: [common, tpa]
  tags: always
