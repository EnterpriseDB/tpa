---

# Instead of running setup, we detect and set some facts ourselves. Once
# we need to support more distributions, we will need a separate play to
# run setup.

- name: Determine what distribution we're running
  shell: (test -f /etc/debian_version && echo debian) || (test -f /etc/redhat-release && echo redhat)
  register: distribution
  changed_when: False

- name: Set ansible_distribution
  set_fact:
    ansible_distribution: "{{ distribution.stdout }}"

- name: Set ansible_pkg_mgr based on ansible_distribution
  set_fact:
    ansible_pkg_mgr: "{{dict(redhat='yum', debian='apt')[ansible_distribution]}}"

- name: Determine Python version
  command: python -c 'import platform; print platform.python_version()'
  register: version
  changed_when: False

- name: Set ansible_python_version
  set_fact:
    ansible_python_version: "{{ version.stdout }}"
