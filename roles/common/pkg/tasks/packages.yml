---

# Copyright Â© 2ndQuadrant Limited <info@2ndquadrant.com>

- name: Install required packages
  package:
    name: >
      {{ query('flattened', package_lists) }}
    state: latest
  vars:
    package_lists:
      - "{{ default_packages['common'] }}"
      - "{{ packages['common']|default([]) }}"
      - "{{ default_packages[ansible_distribution] }}"
      - "{{ packages[ansible_distribution]|default([]) }}"

- name: Install optional packages
  package:
    name: "{{ item }}"
    state: latest
  with_items:
    - "{{ default_optional_packages['common'] }}"
    - "{{ optional_packages['common']|default([]) }}"
    - "{{ default_optional_packages[ansible_distribution] }}"
    - "{{ optional_packages[ansible_distribution]|default([]) }}"
  ignore_errors: yes

- name: Remove unwanted packages
  package:
    name: >
      {{ query('flattened', package_lists) }}
    state: absent
  vars:
    package_lists:
      - "{{ default_unwanted_packages[ansible_distribution] }}"
      - "{{ unwanted_packages[ansible_distribution]|default([]) }}"
