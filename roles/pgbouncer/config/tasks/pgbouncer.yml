---

# Copyright Â© 2ndQuadrant Limited <info@2ndquadrant.com>

- name: Ensure /etc/pgbouncer exists
  file:
    path: /etc/pgbouncer
    owner: "{{ postgres_user }}"
    group: "{{ postgres_group }}"
    mode: 0700
    state: directory

- name: Install pgbouncer.ini
  template:
    src: pgbouncer.ini.j2
    dest: "/etc/pgbouncer/pgbouncer.ini"
    owner: "{{ postgres_user }}"
    group: "{{ postgres_group }}"
    mode: 0640
  notify:
    - Note pgbouncer restart required

- name: Install userlist.txt
  template:
    src: userlist.txt.j2
    dest: "/etc/pgbouncer/userlist.txt"
    owner: "{{ postgres_user }}"
    group: "{{ postgres_group }}"
    mode: 0600
  notify:
    - Note pgbouncer restart required

- name: Enable pgbouncer on boot
  service:
    name: pgbouncer
    enabled: yes
