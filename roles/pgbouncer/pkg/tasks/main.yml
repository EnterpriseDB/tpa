---

- name: Install pgbouncer package
  package:
    name: >
      {{ query('flattened', package_lists) }}
    state: "{{
      (pgbouncer_package_version is defined)|ternary('present', 'latest')
    }}"
  vars:
    package_lists:
      - "{{ pgbouncer_packages|packages_for(ansible_distribution, pgbouncer_package_version) }}"
  tags: [pgbouncer, pkg]

- name: Install Postgres client package
  package:
    name: "{{
      postgres_client_packages|packages_for(ansible_os_family, postgres_package_version)
    }}"
    state: "{{
      (postgres_package_version is defined)|ternary('present', 'latest')
    }}"
  tags: [pgbouncer, postgres, pkg]
