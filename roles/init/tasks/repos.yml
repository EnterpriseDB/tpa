---

# Â© Copyright EnterpriseDB UK Limited 2015-2025 - All rights reserved.

# We have the following package sources available to us:
#
# 1. Repositories defined in {apt,yum}_repositories and listed in
#    {apt,yum}_repository_list (to activate the definitions). This
#    includes PGDG, EPEL, and any extra user-defined repositories.
#
# 2. Repositories listed in edb_repositories, which may be empty. We
#    always need an EDB_SUBSCRIPTION_TOKEN to access these repositories.
#
# In principle, we want config.yml to spell out exactly which of these
# sources to use in any given cluster. However, must maintain backwards
# compatibility with decisions we've made in the past to implicitly add
# repositories in certain circumstances.

- set_fact:
    edb_repositories: "{{ edb_repositories|default([]) }}"
    edb_repos_token: "{{ lookup('env', 'EDB_SUBSCRIPTION_TOKEN') }}"

- assert:
    that:
      edb_repositories is not empty
      or bdr_version is not defined
      or disable_repository_checks|default(false)
    fail_msg: >-
      You must set edb_repositories to use BDR/PGD

- assert:
    that: edb_repositories is empty or edb_repos_token != ''
    fail_msg: >-
      You must obtain a token from
      https://www.enterprisedb.com/repos-downloads and
      'export EDB_SUBSCRIPTION_TOKEN=<token>' to use edb_repositories
