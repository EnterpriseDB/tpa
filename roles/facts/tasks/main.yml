---

# Â© Copyright EnterpriseDB UK Limited 2015-2022 - All rights reserved.

- include_tasks: distribution.yml

- include_tasks: sys.yml

- include_tasks: postgres.yml

# We attempt to gather postgres facts only if there is a valid PGDATA
# directory, the postgres user exists, and postgres is running; or in
# other words, only if we have a reasonable chance of being able to
# connect to Postgres. At this early stage of deployment, it is not an
# error if these conditions are not met (e.g., when we are attaching an
# existing PGDATA to a new instance).

- include_role: name=postgres/facts
  when: >
    'postgres' in role and
    pgdata_initialised|default('false') == True and
    pgdata_user|default('UNKNOWN') != 'UNKNOWN' and
    postgres_running|default('false') == True

# We may change default values over time, but the changes are not always
# worth forcing a reload or restart on existing clusters. Now that we've
# finished running minimal_postgres_setup and cluster_discovery, we can
# alter default values, if needed, based on the values in cluster_facts.

- include_tasks: update-defaults.yml
