---

# This would ordinarily happen in postgres/final, but it's repeated here
# for Postgres-XL clusters that don't apply that role.

- include_role: name=postgres/createuser/final
  when: >
    backup is defined and
    ('coordinator' in role or 'postgres' in role) and'replica' not in role

- include_tasks: server.yml
  when: >
    'barman' in role

- include_tasks: client.yml
  with_items: "{{ backup|default([]) }}"
  loop_control:
    loop_var: this_barman
  vars:
    slot_name: "backup_{{ this_barman|replace('-', '_') }}"
