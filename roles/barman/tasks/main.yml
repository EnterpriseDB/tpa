---

# This role can be safely applied to every instance.
#
# We declare dependencies on a series of sys/ssh modules in order to set
# up password-less ssh between postgres@ and barman@. See meta/main.yml
# for details.

# On any instance tagged as a Barman server (i.e., where tags.role
# includes 'barman'), it will install and configure Barman.

- include_tasks: server.yml
  when: >
    'barman' in role

# On any instance that must be backed up (i.e., with tags.backup set to
# the name of a Barman server), it will perform the necessary
# client-side configuration.

- include_tasks: client.yml
  when: backup is defined

# On any other kind of instance, we do nothing.
