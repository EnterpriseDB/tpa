---

# Copyright Â© 2ndQuadrant Limited <info@2ndquadrant.com>

- name: Set test output directory
  hosts: all
  tasks:
    - set_fact:
        output_dir: >-
          {{ cluster_dir }}/test/{{ lookup('pipe', 'date +%s') }}
      run_once: yes
      tags: always

- import_playbook: "{{ tpa_dir }}/architectures/lib/init.yml"
  vars:
    pgdata_initialised: "{{ 'postgres' in role }}"
  tags: always

- name: Test instances
  any_errors_fatal: True
  max_fail_percentage: 0
  hosts: all
  tasks:
    - include_role:
        name: test
        apply:
          tags: test
      tags: always
