---

# Copyright Â© 2ndQuadrant Limited <info@2ndquadrant.com>

- name: Set test output directory
  hosts: all
  tasks:
    - set_fact:
        output_dir: >-
          {{ cluster }}/test/{{ lookup('pipe', 'date +%s') }}
      run_once: yes

- import_playbook: "{{ tpa_dir }}/architectures/lib/init.yml"
  vars:
    pgdata_initialised: "{{ 'postgres' in role }}"

- name: Test instances
  any_errors_fatal: True
  max_fail_percentage: 0

  hosts: all
  tasks:
    - include_role: name=test
      tags: test
