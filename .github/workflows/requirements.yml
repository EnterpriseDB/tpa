# Â© Copyright EnterpriseDB UK Limited 2015-2022 - All rights reserved.

# watch for changes in .in files and call pip-compile to update the associated .txt
# runs dep check to ensure everything is fine after update.

name: Python requirements file update
# runs on push that made changes to one of the .in files inside the project.
on:
  push:
    paths:
      - ansible.in
      - requirements.in
      - requirements/*.in
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
env:
  LC_ALL: C.UTF-8
  LANG: C.UTF-8
  GITHUB_TOKEN: ${{ secrets.GITHUBSECURITYTOKEN }}

jobs:
  requirements:
    name: Requirements update
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v3

      - uses: ./.github/actions/update-requirements

      - name: Install tox
        run: pip install tox

      - name: Run dependence tree with tox
        run: |
          TOX_PARALLEL_NO_SPINNER=1 tox -e dep
