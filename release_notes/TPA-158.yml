- summary: Ensure pgpass_users correctly added to .pgpass file
  description: |
    Previously, any user in the `postgres_users` list specified with
    `generate_password: true` AND included in the `pgpass_users` list
    would NOT be added to the `~postgres/.pgpass` file on the initial
    deploy because the user's password did not yet exist when the
    pgpass task was executed, thus the user was skipped.

    This is fixed by invoking the pgpass task once more after all the
    Postgres users have been created.

    The `repmgr` and `replication` users were previously included in the
    `default_pgpass_users` list. They are now added to `pgpass_users` and
    hence to the .pgpass file as required by the replication manager in use.

    The `postgres_user` (`postgres` or `enterprisedb` by default) is still part
    of the `default_pgpass_users` list. If this is overridden by a `pgpass_users` list
    in `config.yml` that does NOT include `postgres_user`, a PEM-enabled cluster will
    fail to register agents as it needs the encrypted `postgres_user` password.
    This is fixed by adding the `postgres_user` to the `~postgres/.pgpass` file
    as part of the PEM agent tasks.
  # Possible types: notable_change, minor_change, bugfix or breaking_change
  type: bugfix
  # At least one between jira_tickets or support_tickets must be defined. You
  # can define both if you want
  # You must have at least one list item in each *_tickets section that is
  # defined
  jira_tickets:
  - TPA-158
  - TPA-1075
