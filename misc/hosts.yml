---

# Quick hack:
#
# Can be used to regenerate /etc/hosts on all instances in a cluster.
# This must be invoked in the context of the cluster's inventory.
#
# XXX That this does not work correctly if you're using sys/openvpn,
# because it'll use the non-openvpn IPs to generate /etc/hosts.

- name: Set up inventory variables
  hosts: all
  any_errors_fatal: True
  max_fail_percentage: 0
  roles:
    - role: platforms
      tags: always
  post_tasks:
    - name: Generate /etc/hosts
      template:
        src: ../roles/sys/hosts/templates/hosts.j2
        dest: /etc/hosts
        owner: root
        group: root
        mode: 0644
      become_user: root
      become: yes
