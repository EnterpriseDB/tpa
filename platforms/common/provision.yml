---

- name: Ensure that the cluster's inventory directories exist
  file:
    path: "{{ cluster_dir }}/{{ item }}"
    state: directory
  with_items:
    - inventory
    - inventory/host_vars
    - inventory/group_vars

- name: Set ssh_key_file
  set_fact:
    ssh_key_file: >-
      {{ ssh_key_file|default('id_' + cluster_name|lower) }}

- name: Create ssh keypair
  include_tasks: ssh-key.yml
  vars:
    key_file: "{{ ssh_key_file }}"
  tags: [ssh, keygen]

- include_tasks: ssh-hostkeys.yml
  tags: [ssh, keygen]

- include_tasks: set-vault-pass.yml
