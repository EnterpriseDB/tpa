---

# Generate a shared vault password for this cluster
- name: Ensure that the cluster's vault directory exists
  file:
    path: "{{ cluster_dir }}/vault"
    state: directory

# We generate a random vault passphrase and store it in a text file.
# This obviously needs improvementâ€”we should GPG-encrypt it with the
# public keys of everyone who needs access to the secret.

- name: Generate the vault passphrase for this cluster
  local_action: >
    shell {{ tpa_dir }}/bin/password > vault_pass.txt
  args:
    chdir: "{{ cluster_dir }}/vault"
    creates: "vault_pass.txt"
