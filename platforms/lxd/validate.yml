---

# Copyright Â© 2ndQuadrant Limited <info@2ndquadrant.com>

# Make that every instance has an image explicitly specified by id.

- name: Ensure that every instance has a defined alias image
  assert:
    msg: "Please set 'alias' on every instance"
    that:
      - lxd_instances|selectattr('alias','defined')|list|count == lxd_instances|count

- name: Ensure that an IP address is specified for the instance
  assert:
    msg: "LXD instances must specify an ip_address"
    that:
      item.get('ip_address')
  with_items: "{{ lxd_instances }}"

- name: Set valid instance keys
  set_fact:
    valid_instance_keys: "{{
      valid_instance_keys|default({})|combine({
        'lxd': instance_keys
      })
    }}"
  vars:
    instance_keys:
    - alias
    - ip_address
    - lxd_url
    - mode
    - server
    - protocol
    - architecture
    - profile
    - memory
    - nesting
    - privileged
    - storage_pool
    - disk_space
    - disk_type
    - nictype
    - network
    - interface_type
    - wait_for_ipv4_addresses
