---

# Â© Copyright EnterpriseDB UK Limited 2015-2021 - All rights reserved.

# We expect 'cluster' to point to a directory in which we can find
# config.yml (or whatever 'config' is set to). If we are invoked through
# tpaexec provision, we can count on cluster being set, but we check
# anyway.

- name: Require cluster directory to be specified
  assert:
    msg: "No cluster directory specified"
    that:
      - cluster_dir is defined and cluster_dir != ''

- name: Set tpa_dir
  set_fact:
    tpa_dir: "{{ tpa_dir|default(lookup('env', 'TPA_DIR')) }}"
  tags: always

- name: Set full path to cluster_dir and config_file
  set_fact:
    config_file: "{{ cluster_dir }}/{{ file }}"
  vars:
    file: >-
      {{ config|default('config.yml') }}

- name: Load cluster configuration file
  include_vars: "{{ config_file }}"
