Vagrant.configure("2") do |config|
{% if vagrant_proxyconf is defined %}
  if Vagrant.has_plugin?('vagrant-proxyconf')
    config.proxy.http = "{{ vagrant_proxyconf }}"
    config.proxy.https = "{{ vagrant_proxyconf }}"
  end
{% endif %}
{% if vagrant_ca_certificates %}
  if Vagrant.has_plugin?('vagrant-ca-certificates')
    config.ca_certificates.enabled = true
    config.ca_certificates.certs = Dir.glob('{{ vagrant_ca_certificates }}')
  end
{% endif %}
  config.vm.provision "file", source: "{{ ssh_key_file }}.pub", destination: "/tmp/authorized_keys"
{% for alg in ['rsa', 'ecdsa'] %}
{%   for ext in ['', '.pub'] %}
{%     set f = 'ssh_host_%s_key%s' % (alg, ext) %}
  config.vm.provision "file", source: "hostkeys/{{ f }}", destination: "/tmp/{{ f }}"
{%   endfor %}
{% endfor %}
  config.vm.provision "shell", path: "init.sh"
{% for h in instance_vars %}
  config.vm.define "{{ h.Name }}" do |{{ h.Name }}|
    config.vm.box = "{{ h.image }}"
    {{ h.Name }}.vm.hostname = '{{ h.Name }}'
    {{ h.Name }}.vm.network :private_network, ip: '{{ h.ip_address }}'
    {{ h.Name }}.vm.provider :virtualbox do |v|
      v.customize ["modifyvm", :id, "--name", "{{ h.Name }}"]
{%   if h.get('memory') %}
      v.customize ["modifyvm", :id, "--memory", {{ h.memory }}]
{%   endif %}
      v.customize ["modifyvm", :id, "--natdnshostresolver1", "on"]
    end
  end
{% endfor %}
end
