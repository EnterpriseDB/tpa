---

- name: Update DNS records in Route53
  route53:
    command: create
    zone: "{{ item.0.route53_zone|default(route53_zone) }}"
    hosted_zone_id: "{{ item.0.route53_hosted_zone_id|default(route53_hosted_zone_id) }}"
    record: "{{ item.1.Name }}.{{ item.0.route53_zone|default(route53_zone) }}"
    value: "{{ item.1.ip_address }}"
    type: A
    ttl: 60
    wait: yes
  with_together:
    - "{{ aws_instances }}"
    - "{{ instance_vars }}"
  loop_control:
    label: >-
      {{ item.1.Name }}
  when:
    (item.0.route53_hosted_zone_id is defined or route53_hosted_zone_id is defined) and
    (item.0.route53_zone is defined or route53_zone is defined)
