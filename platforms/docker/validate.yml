---

# Copyright Â© 2ndQuadrant Limited <info@2ndquadrant.com>

- name: Ensure that every instance has a defined image
  assert:
    msg: "Please set 'image' on every instance"
    that:
      - docker_instances|selectattr('image','defined')|list|count == docker_instances|count

- name: Ensure that docker_images, if defined, is a hash
  assert:
    msg: "Expected docker_images to map image names to build instructions"
    that:
      - docker_images is not defined or
        docker_images is mapping

- name: Set valid instance keys
  set_fact:
    valid_instance_keys: "{{
      valid_instance_keys|default({})|combine({
        'docker': instance_keys
      })
    }}"
  vars:
    instance_keys:
    - image
    - privileged
    - restart_policy
    - memory
    - shm_size
    - env_file
    - env
    - log_driver
    - log_options
    - exposed_ports
    - published_ports
    - devices
    - networks
    - sysctls
    - ulimits
