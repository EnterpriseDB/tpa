#!/bin/bash
#
# Provisions a cluster according to config.yml

IFS=
set -e -u

TOP=/opt/2ndQuadrant/TPA
if [[ ! -d $TOP ]]; then
    TOP=$(dirname $0)/..
    type realpath &>/dev/null && TOP=$(realpath $TOP)
fi
export TPA_DIR=${TPA_DIR:-$TOP}

cluster=${1:?No cluster specified}
shift

cd $cluster

$TPA_DIR/ansible/ansible-playbook \
    $TPA_DIR/platforms/provision.yml \
    -e cluster=$(pwd) "$@"
