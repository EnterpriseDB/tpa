---

- name: Install pip
  raw: apt-get -y install python-pip
  register: pip
  changed_when: "'already the newest version' not in pip.stdout"
  when: ansible_distribution == 'debian'

- name: Install pip
  raw: yum install -y python-pip
  register: pip
  changed_when: "'already installed and latest version' not in pip.stdout"
  when: ansible_distribution == 'redhat'

# If we have neither ssl.match_hostname (included in Python â‰¥ 2.7.9) or
# backports.ssl_match_hostname, we need to install the latter using pip.
# It's easier to check the version, and since running "pip install foo"
# twice should have no effect the second time, that's what we do here.

- name: Install backports.ssl_match_hostname
  command: pip install backports.ssl_match_hostname
  register: backport
  changed_when: "'Requirement already satisfied' not in backport.stdout"
  when: ansible_python_version | version_compare('2.7.9', '<')
