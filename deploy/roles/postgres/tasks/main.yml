---

- name: Ensure Postgres configuration is present
  assert:
    that:
      - pgversion is defined

- include: packages.yml
- include_vars: "{{ansible_distribution}}.yml"

- name: Install Postgres configuration files
  template:
    src="{{ item }}.j2" dest="{{ pgconf }}/{{ item }}"
    owner=postgres group=postgres mode=0640
  with_items:
    - pg_hba.conf
    - postgresql.conf
  register: pgconfig

- name: Restart Postgres
  service: name=postgresql state=restarted
  when: pgconfig.changed

- name: Disable Postgres autostart on reboot
  service:
     name: postgresql
     enabled: no

- include: ssh.yml
