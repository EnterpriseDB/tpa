---

cluster_name: tpa_test
cluster_tags:
  Owner: AMS
cluster_vars:
  vpn_network: 192.168.33.0/24

ec2_vpc:
  Name: Test

ec2_vpc_subnets:
  eu-west-1:
    10.33.29.0/28:
      az: eu-west-1a
    10.33.27.16/28:
      az: eu-west-1b

ec2_instance_reachability: public

# To use another AMI, you can override ec2_ami* from the command-line:
#
# «-e '{"ec2_ami":{"Name":"TPA-RedHat-PGDG-9.6-2017*","Owner":"self"}}' -e ec2_ami_user=ec2-user»

ec2_ami:
  Name: TPA-Debian-PGDG-10-2018*
  Owner: self
ec2_ami_user: admin

instances:
    - node: 1
      Name: pear
      type: t2.micro
      region: eu-west-1
      subnet: 10.33.29.0/28
      volumes:
          - raid_device: /dev/md0
            device_name: /dev/xvdb
            volume_type: gp2
            volume_size: 16
            raid_units: 2
            attach_existing: yes
            vars:
              volume_for: postgres_data
      role: primary
      vars:
        work_mem: 16MB

    - node: 2
      Name: plum
      type: t2.micro
      region: eu-west-1
      subnet: 10.33.29.0/28
      volumes:
          - device_name: /dev/xvdb
            volume_type: gp2
            volume_size: 16
            attach_existing: yes
            vars:
              mountpoint: /var/lib/postgresql
      role: replica
      upstream: pear
      backup: peach
      vars:
        work_mem: 21MB
        postgres_data_dir: /var/lib/postgresql/data

    - node: 3
      Name: kiwi
      type: t2.micro
      region: eu-west-1
      subnet: 10.33.27.16/28
      volumes:
          - device_name: /dev/xvdb
            volume_type: gp2
            volume_size: 16
            vars:
              volume_for: postgres_data
      role: replica
      upstream: plum

    - node: 4
      Name: peach
      type: t2.micro
      region: eu-west-1
      subnet: 10.33.27.16/28
      volumes:
          - device_name: root
            volume_type: gp2
            volume_size: 16
          - device_name: /dev/xvdb
            volume_type: gp2
            volume_size: 32
            vars:
              volume_for: postgres_data
              random: 42
      role:
        - barman
        - witness
        - log-server
        - openvpn-server
        - monitoring-server
      upstream: pear
