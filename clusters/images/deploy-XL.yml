---

- name: Set up TPA image nodes
  any_errors_fatal: True
  max_fail_percentage: 0
  become_user: root
  become: true

  # This is incomplete and currently untested.

  hosts: all
  roles:
    - role: platforms
      become: no

    - role: common/pkg
    - role: postgres/vars
    - role: postgres-xl/src
    - role: sys/openvpn/pkg
    - role: sys/rsyslog/pkg
    - role: pglogical/pkg
    - role: pgbouncer/pkg
    - role: barman/pkg
    - role: repmgr/pkg

    - role: sys/upgrade
    - role: sys/firstboot
