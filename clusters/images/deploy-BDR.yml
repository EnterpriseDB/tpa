---

- name: Set up TPA image nodes
  hosts: tag_Cluster_TPAImages
  any_errors_fatal: True
  max_fail_percentage: 0
  sudo_user: root
  sudo: true

  pre_tasks:
    - include: ../../platforms/aws/hostvars.yml
      tags: always

  roles:
    - role: postgres/vars
      vars:
        postgres_version: 9.4

    - role: common/pkg
    - role: sys/openvpn/pkg
    - role: sys/rsyslog/pkg
    - role: bdr/pkg
    - role: pglogical/pkg
    - role: pgbouncer/pkg
    - role: barman/pkg
    - role: repmgr/pkg

    - role: sys/upgrade
    - role: sys/firstboot

