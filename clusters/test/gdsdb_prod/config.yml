--- # GDS DB Prod cluster: Do not touch this config, do not delete any instance listed here!
cluster_name: "gdsdb_prod"
cluster_tags:
  Owner: GDS

cluster_vars:
  cluster_network:
    - 10.66.0.0/16
    - 10.77.0.0/16
  vpn_network: 192.168.33.0/24

ec2_ami:
  Name: ubuntu/images/hvm-ssd/ubuntu-xenial-16.04-amd64-server-20170803
ec2_ami_user: ubuntu

cluster_rules:
- proto: tcp
  ports:
    - 5432
    - 6432
  cidr_ip: 34.207.135.250/32
- proto: tcp
  ports:
    - 5432
    - 6432
  cidr_ip: 54.152.243.244/32
- proto: udp
  ports:
    - 1194
  cidr_ip: 0.0.0.0/0
- proto: tcp
  ports:
    - 22
  cidr_ip: 0.0.0.0/0

ec2_vpc:
  Name: GDS-PROD

ec2_vpc_subnets:
  us-east-1:
    10.66.0.32/28:
      az: us-east-1a
    10.66.2.32/28:
      az: us-east-1b
  us-west-1:
    10.77.0.32/28:
      az: us-west-1b

instances:
    - node: 1
      Name: horizons
      type: t2.micro
      region: us-east-1
      subnet: 10.66.0.32/28
      private_ip: 10.66.0.40
      tags:
        role: primary
        backup: rainbow
        log: rainbow

    - node: 2
      Name: mutiny
      type: t2.micro
      region: us-east-1
      subnet: 10.66.2.32/28
      private_ip: 10.66.2.40
      tags:
        role: replica
        upstream: horizons
        backup: rainbow
        log: rainbow

    - node: 3
      Name: rainbow
      type: t2.micro
      region: us-west-1
      subnet: 10.77.0.32/28
      volumes:
          - device_name: /dev/xvdb
            volume_type: gp2
            volume_size: 32
            attach_existing: yes
            vars:
              mountpoint: /var/lib/barman
      private_ip: 10.77.0.40
      tags:
        role:
          - witness
          - barman
          - log-server
          - openvpn-server
          - monitoring-server
          - pgbouncer
        upstream: horizons

