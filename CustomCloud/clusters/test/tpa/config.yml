---

cluster_name: tpa_test
cluster_tags:
  Owner: AMS
cluster_vars:
  cluster_network: 10.33.21.0/24

ec2_vpc:
  Name: Test

ec2_vpc_subnets:
  eu-west-1:
    10.33.29.0/28:
      az: eu-west-1a
    10.33.27.16/28:
      az: eu-west-1b

ec2_ami:
  Name: TPA-Debian-PGDG-9.6-2016*
  Owner: self
ec2_ami_user: admin

instances:
    - node: 1
      type: t2.micro
      region: eu-west-1
      subnet: 10.33.29.0/28
      volumes:
          - raid_device: /dev/md0
            device_name: /dev/xvdb
            volume_type: gp2
            volume_size: 16
            raid_units: 2
            vars:
              mount_as: postgres_home
      tags:
        os: Debian
        role: primary
        Name: debian-primary
      vars:
        max_connections: 222
        shared_buffers: '64MB'

    - node: 2
      type: t2.micro
      region: eu-west-1
      subnet: 10.33.29.0/28
      volumes:
          - device_name: /dev/xvdb
            volume_type: gp2
            volume_size: 16
            vars:
              mountpoint: /var/lib/postgresql
      tags:
        os: Debian
        role: replica
        Name: debian-replica
        upstream: debian-primary
        backup: debian-witness

    - node: 3
      type: t2.micro
      region: eu-west-1
      subnet: 10.33.27.16/28
      volumes:
          - device_name: /dev/xvdb
            volume_type: gp2
            volume_size: 16
            vars:
              mount_as: postgres_home
      tags:
        os: Debian
        role: replica
        Name: debian-cas-replica
        upstream: debian-replica

    - node: 4
      type: t2.micro
      region: eu-west-1
      subnet: 10.33.27.16/28
      volumes:
          - device_name: /dev/xvdb
            volume_type: gp2
            volume_size: 32
            vars:
              mount_as: postgres_home
      tags:
        os: Debian
        role:
          - barman
          - witness
          - log-server
          - openvpn-server
          - monitoring-server
        Name: debian-witness
        upstream: debian-primary
