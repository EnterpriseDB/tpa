---

- name: Set up TPA cluster nodes
  hosts: tag_Name_TPA_RHEL
  gather_facts: no
  sudo_user: root
  sudo: true

  vars:
    pgversion: 9.5

  pre_tasks:
    - include: ../../../platforms/aws/hostvars.yml

    - name: Set the node id and hostname as facts
      set_fact:
        node_id: "{{ ec2_tag_node }}"
        cluster_hostname: "{{ cluster_name|lower + ec2_tag_node }}"
      tags: always

  roles:
    - role: common

    - role: sys/tune
      tags: always

    - role: sys/sysctl
      tags: sysctl

    - role: postgres/pkg
      tags: postgres

    - role: sys/ssh
      user: postgres
      tags: ssh
