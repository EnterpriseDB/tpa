---

- name: Set up TPA cluster nodes
  hosts: tag_Cluster_GCBenchmarks
  any_errors_fatal: True
  max_fail_percentage: 0
  sudo_user: root
  sudo: true
  vars:
    cluster_network: 10.33.221.0/28

  pre_tasks:
    - include: ../../../platforms/aws/hostvars.yml
      tags: always

  roles:
    - role: common
    - role: postgres/vars
      vars:
        postgres_version: 9.6
      tags: always
    - role: sys/tune
      tags: always
    - role: sys/sysctl
      tags: [sys, sysctl]
    - role: sys/hosts
      tags: [sys, hosts]
    - role: postgres
      when: >
        'postgres' in role
    - role: barman
      tags: barman
    - role: repmgr
      tags: repmgr
    - role: pgbouncer
      tags: pgbouncer
    - role: postgres/final
      when: >
        'postgres' in role
      tags: [postgres, final]
