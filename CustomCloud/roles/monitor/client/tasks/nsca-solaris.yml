---

# roles/client/tasks/nsca-solaris.yml
#
# Compile nsca-ng client on Solaris systems

  # Check that standard directories exist
- name: Ensure ~/var directory exists
  file: path=~/var state=directory

- name: Download nsca-ng 1.4
  get_url: url=http://www.nsca-ng.org/download/nsca-ng-1.4.tar.gz dest=~/var/nsca-ng-1.4.tar.gz

- name: Extract the nsca-ng archive
  unarchive: src=~/var/nsca-ng-1.4.tar.gz dest=~/var copy=no

- name: Configure nsca-ng
  command: ./configure
  environment:
    PATH: "{{ ansible_env.PATH }}:/opt/csw/bin:/usr/bin:/usr/sbin:/usr/sfw/bin:/usr/local/bin"
  args:
    chdir: ~/var/nsca-ng-1.4
    creates: ~/var/nsca-ng-1.4/Makefile

- name: Build nsca-ng
  command: make
  environment:
    PATH: "{{ ansible_env.PATH }}:/opt/csw/bin:/usr/bin:/usr/sbin:/usr/sfw/bin:/usr/local/bin"
  args:
    chdir: ~/var/nsca-ng-1.4
    creates: ~/var/nsca-ng-1.4/src/client/send_nsca

  # Deploy the executable
- name: Copy send_nsca
  synchronize: mode=pull src=~/var/nsca-ng-1.4/src/client/send_nsca dest=~/bin/send_nsca
  delegate_to: "{{inventory_hostname}}"



