---

# roles/client/tasks/main.yml
#
# Add or remove a client server from monitoring.
#
# Note that despite the `when` condition, Ansible will include each
# playbook but skip all tasks if the `when` condition is not met.

- name: Set up client server scripts for standard monitoring
  include: add-monitoring.yml
  when: (monitoring|bool == true) and (server_role == "database")

- name: Set up client server scripts for barman monitoring
  include: add-barman-monitoring.yml
  when: (monitoring|bool == true) and (server_role == "barman")

- name: Set up gateway server
  include: add-gateway.yml
  when: (monitoring|bool == true) and (server_role == "nsca_gateway")

- name: Remove client server monitoring scripts
  include: remove-monitoring.yml
  when: (monitoring|bool == false) and (server_role == "database")
