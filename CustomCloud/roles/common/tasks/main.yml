---

- name: Tell ssh to use this cluster's known_hosts file
  set_fact:
    ansible_ssh_common_args: "-o UserKnownHostsFile='{{playbook_dir}}/known_hosts'"
  when: ansible_ssh_common_args == ""

# Set ansible_distribution and ansible_pkg_mgr if required.
- include: distribution.yml
  tags: always

# Once we know what distribution we are dealing with, we must ensure
# that a usable Python (2.7.x) is installed, along with anything else
# that is required to run "pkg" below.
- include: "os/{{ ansible_os_family }}.yml"
  tags: [common, pkg]

# We have Python and pip; install any other required Python packages,
# and then install/uninstall any system packages.
- include: python.yml
  tags: [common, pkg]
- include: packages.yml
  tags: [common, pkg]

# Set node hostnames and generate /etc/hosts
- include: hosts.yml
  tags: common

# Generate secrets for various components
- include: secrets.yml
  tags: [common, secrets]

# Add TPA version number along with timestamp to the instance
- include: tpa_version.yml
  tags: common
