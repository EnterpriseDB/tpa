---

- name: Ensure that /etc/tpa exists
  file:
    path: /etc/tpa
    state: directory
    mode: 0755

- name: Generate self-signed TLS key and certificate
  shell: >
    /bin/echo -e "--\nState\nCity\nOrganization\nOrganizationalUnit\nlocalhost.localdomain\nroot@localhost.localdomain\n" |
    /usr/bin/openssl req -newkey rsa:2048 -keyout "{{ cluster_name }}.key" -nodes -x509 -days 365 -out "{{ cluster_name }}.crt"
  args:
    chdir: /etc/tpa
    creates: "{{ cluster_name }}.crt"
