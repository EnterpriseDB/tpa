---

- name: Tell ssh to use this cluster's known_hosts file
  set_fact:
    ansible_ssh_common_args: "-o UserKnownHostsFile='{{playbook_dir}}/known_hosts'"
  when: ansible_ssh_common_args == ""

# If pwgen is not installed, we would silently generate invalid YAML
# in roles/secret, so we check up-front and fail early. We depend on
# flock to workaround a problem with run_once, so check for that too.

- name: Ensure that local dependencies are installed
  assert:
    msg: "Please install {{ item }} locally"
    that:
      - "'{{ lookup('pipe', 'which {{ item }} || true') }}' != ''"
  with_items:
    - pwgen
    - flock
