---

- name: Determine Python version
  command: "{{ ansible_python_interpreter }} -c 'import platform; print platform.python_version()'"
  register: version
  changed_when: False

- name: Set ansible_python_version
  set_fact:
    ansible_python_version: "{{ version.stdout }}"

# If we have neither ssl.match_hostname (included in Python â‰¥ 2.7.9) or
# backports.ssl_match_hostname, we need to install the latter using pip.
# It's easier to check the version, and since running "pip install foo"
# twice should have no effect the second time, that's what we do here.

- name: Install backports.ssl_match_hostname
  command: pip install backports.ssl_match_hostname
  register: backport
  changed_when: "'Requirement already satisfied' not in backport.stdout"
  when: ansible_python_version | version_compare('2.7.9', '<')

- name: Install boto
  command: pip install boto
  register: boto
  changed_when: "'Requirement already satisfied' not in boto.stdout"
