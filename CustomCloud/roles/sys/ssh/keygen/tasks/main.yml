---

# Locally creates a keypair named id_user in playbook_dir/keys.
#
# - role: sys/ssh/keygen
#   user: xxx
#   ssh_key_dir: '/some/other/dir'
#   ssh_key_file: 'id_somefilename'
#   ssh_key_comment: 'xxx@yyy'

- name: Ensure {{ _ssh_key_dir }} exists locally
  local_action:
    module: file
    path: "{{ _ssh_key_dir }}"
    state: directory
  run_once: yes
  sudo: no

- name: Generate ssh keypair {{ _ssh_key_file }}
  local_action: >
    command ssh-keygen -N "" -C "{{ _ssh_key_comment }}" -f "{{ _ssh_key_file }}"
  args:
    chdir: "{{ _ssh_key_dir }}"
    creates: "{{ _ssh_key_file }}"
  run_once: yes
  sudo: no
