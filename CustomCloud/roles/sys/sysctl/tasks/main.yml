---

# Set any sysctl values specified by the caller, which may augment or
# override the default values defined in vars/main.yml.

- name: Set sysctl values
  sysctl:
    name: "{{ item.key }}"
    value: "{{ item.value }}"
    state: present
    sysctl_file: /etc/sysctl.conf
    reload: yes
  with_dict: "{{ sysctl_defaults|combine(sysctl_values|default({})) }}"

#  - name: Insert/update disabling THP configuration block in /etc/rc.local
#    blockinfile:
#      dest: /etc/rc.local
#      mode: u+x
#      insertbefore: "exit 0"
#      block: |
#       if test -f /sys/kernel/mm/transparent_hugepage/enabled; then
#         echo never > /sys/kernel/mm/transparent_hugepage/enabled
#       fi
#       if test -f /sys/kernel/mm/transparent_hugepage/defrag; then
#         echo never > /sys/kernel/mm/transparent_hugepage/defrag
#       fi
