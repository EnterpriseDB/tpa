---

# This file is meant to be included directly from outside the
# postgres/config role. It expects to be passed the name and (properly
# quoted) value of a postgresql.conf parameter, and will write a file
# into the Postgres include_dir.
#
# We wouldn't have to repeat the definition of _include_dir here if we
# could use include_role/tasks_from to invoke this, but that will have
# to wait until include_role is no longer so broken.

- assert:
    that:
      - variable is defined
      - value is defined

- name: Set override for variable {{ name }}
  template:
    src: variable.j2
    dest: "{{ include_dir|default(postgres_data_dir+'/conf.d') }}/8888-{{ name }}.conf"
    owner: postgres
    group: postgres
    mode: 0644
  notify:
    - Note Postgres restart required
