---

- include_vars: "{{ playbook_dir }}/vault/{{ name }}_password.yml"
  no_log: true

- name: Create the {{ user }} user
  postgresql_user:
    name: "{{ name }}"
    encrypted: yes
    password: "md5{{ (vars[name+'_password'] + 'postgres')|hash('md5') }}"
    role_attr_flags: superuser
  become_user: postgres
  become: yes
