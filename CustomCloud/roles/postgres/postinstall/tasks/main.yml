---

# Once we've performed all the basic installation and configuration
# tasks, we perform any followup actions that require Postgres to be
# running.

# We restart Postgres unconditionally for now. In the near future we
# should use a notifier mechanism so that we restart only when the
# Postgres configuration has changed.

- name: Restart Postgres unconditionally
  service: name={{ postgres_service_name }} state=restarted

- include: extensions.yml

- include: create-superuser.yml
  vars:
    username: "{{ item }}"
  with_items: "{{ _superusers }}"

- include: barman.yml
  when: >
    backup != '' and initialise_backup is defined
