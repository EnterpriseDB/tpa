---

- name: Check if the data directory is not empty
  stat: path={{ postgres_data_dir }}/PG_VERSION
  register: data_dir

- name: Invoke pg_createcluster
  command: pg_createcluster -d {{ postgres_data_dir }} -p 5432 --start-conf auto {{ pgversion }} main -- {% for x in postgres_initdb_opts %}{{x|quote}} {% endfor %}
  sudo_user: root
  when: data_dir.stat.exists == false
