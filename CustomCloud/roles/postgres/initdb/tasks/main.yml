---

- name: Set Postgres data directory
  set_fact:
    postgres_data_dir: "{{ postgres_data_dir|default(default_postgres_data_dirs[ansible_os_family]) }}"
    postgres_service_name: "{{ postgres_service_name|default(default_postgres_service_names[ansible_os_family]) }}"
  tags: always

- name: Check to see if the data directory is empty
  stat: path="{{ postgres_data_dir }}/PG_VERSION"
  register: pgdata
  tags: [postgres, initdb]

- include: "os/{{ ansible_os_family }}.yml"
  when: not pgdata.stat.exists
  tags: [postgres, initdb]
