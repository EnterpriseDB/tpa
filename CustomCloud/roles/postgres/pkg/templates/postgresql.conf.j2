data_directory = '{{ pgdata }}'
hba_file = '{{ pgconf }}/pg_hba.conf'
ident_file = '{{ pgconf }}/pg_ident.conf'
external_pid_file = '{{ pgsock }}/{{ pgversion }}-main.pid'
unix_socket_directories = '{{ pgsock }}'

listen_addresses = '*'
port = 5432
max_connections = 400

ssl = true
ssl_cert_file = '/etc/ssl/certs/ssl-cert-snakeoil.pem'
ssl_key_file = '/etc/ssl/private/ssl-cert-snakeoil.key'

#------------------------------------------------------------------------------
# RESOURCE USAGE (except WAL)
#------------------------------------------------------------------------------

shared_buffers = 512MB
work_mem = 16MB
maintenance_work_mem = 1GB
autovacuum_work_mem = 256MB

# - Kernel Resource Usage -

shared_preload_libraries = 'auto_explain, pg_stat_statements'

#------------------------------------------------------------------------------
# WRITE AHEAD LOG
#------------------------------------------------------------------------------

wal_level = hot_standby
fsync = on

# - Checkpoints -

checkpoint_timeout = 30min
#max_wal_size = 8GB
checkpoint_completion_target = 0.9

# - Archiving -

archive_mode = on
archive_command = '/bin/true'

#------------------------------------------------------------------------------
# REPLICATION
#------------------------------------------------------------------------------

# - Sending Server(s) -

# Set these on the master and on any standby that will send replication data.

max_wal_senders = 5
wal_keep_segments = 2000

# - Standby Servers -
 
# These settings are ignored on a master server.

hot_standby = on
hot_standby_feedback = on

#------------------------------------------------------------------------------
# ERROR REPORTING AND LOGGING
#------------------------------------------------------------------------------

log_checkpoints = on
log_connections = on
log_disconnections = on
log_line_prefix = '%t [%d:%p] '
log_statement = 'ddl'
log_lock_waits = on
log_error_verbosity = verbose

#------------------------------------------------------------------------------
# RUNTIME STATISTICS
#------------------------------------------------------------------------------

track_activities = on

#------------------------------------------------------------------------------
# AUTOVACUUM PARAMETERS
#------------------------------------------------------------------------------

autovacuum = on
log_autovacuum_min_duration = 0
autovacuum_max_workers = 3

