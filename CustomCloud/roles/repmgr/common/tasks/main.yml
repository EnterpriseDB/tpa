---

- name: Ensure repmgr configuration directory exists
  file:
    path: "{{ repmgr_conf_dir }}"
    owner: postgres
    group: postgres
    mode: 0755
    state: directory

- name: Install repmgr.conf
  template:
    src: repmgr.conf.j2
    dest: "{{ repmgr_conf_dir }}/repmgr.conf
    owner: postgres
    group: postgres
    mode: 0644

# - name: Install assign_eip.py
#   template:
#     src: assign_eip.py.j2
#     dest: "{{ repmgr_conf_dir }}/assign_eip.py
#     owner: postgres
#     group: postgres
#     mode: 0755

- name: Install additional repmgr scripts
  template:
    src: "{{ item }}.j2"
    dest: "{{ repmgr_conf_dir }}"
    owner: postgres
    group: postgres
    mode: 0755
  with_items:
    - promote_command.sh
    - follow_command.sh

- include: "os/{{ ansible_os_family }}.yml"
