---

# First, we generate a pair of SSH host keys in each supported format.

- include: ../common/ssh-hostkeys.yml

# We generated host keys into hostkeys/ssh_host_$type_key{,.pub};
# we now upload those to hostkeys/$type{,.pub}.txt in S3.

- name: Upload SSH host key files
  s3:
    bucket: "{{ cluster_bucket }}"
    object: "{{ cluster_name }}/hostkeys/{{ item.0 }}{{ item.1 }}.txt"
    src: "{{ cluster_dir }}/hostkeys/ssh_host_{{ item.0 }}_key{{ item.1 }}"
    overwrite: different
    expiration: 3600
    mode: put
  with_nested:
    - ["rsa", "ecdsa"]
    - ["", ".pub"]
  register: keyurls
