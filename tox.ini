[tox]
envlist = py36-lint, py38-lint, py36-test, py38-test, dep
skipsdist = True
skip_missing_interpreters = True

[testenv]
setenv =
    PYTHONPATH = lib
    PYTHONDONTWRITEBYTECODE = 1
    PIP_INDEX_URL = https://pypi.org/simple
deps =
    -rrequirements.txt
    -rrequirements/ansible.txt
    {lint,test}: -rrequirements/testing.txt
    dep: pipdeptree
commands =
    lint: prospector -DFM
    test: pytest -p no:cacheprovider ./lib/tests -vv {posargs}
    dep: pipdeptree -w fail

[pytest]
addopts =
    --cov-report term:skip-covered
    --cov-report html:test-output/coverage
    --cov-report xml:coverage-reports/coverage.xml
    --cov=lib
    --html=test-output/tests.html
    -o junit_family=xunit1
    --junitxml coverage-reports/results.xml
    --cov-report term
